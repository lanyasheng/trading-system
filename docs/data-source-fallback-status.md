# 数据源降级链路状态

## 行情数据

| 数据类型 | 主数据源 | 降级 1 | 降级 2 | 降级 3 | 状态 |
|---------|---------|-------|-------|-------|------|
| **A 股实时行情** | 腾讯 | 新浪 | 东方财富 | - | ✅ 完整 |
| **美股实时行情** | 腾讯 US | - | - | - | ✅ 正常 |
| **港股实时行情** | 腾讯 HK | - | - | - | ✅ 正常 |
| **商品期货** | 新浪商品 | - | - | - | ✅ 正常 |
| **K 线数据** | 新浪 (指数) / 腾讯 (个股) | Baostock | pytdx | - | ✅ 完整 |

## 资金流数据

| 数据类型 | 主数据源 | 降级 1 | 降级 2 | 降级 3 | 状态 |
|---------|---------|-------|-------|-------|------|
| **分钟级资金流** | 同花顺 | 东方财富 | 腾讯 (内外盘差) | - | ✅ 已实现 |
| **主力资金净流入** | 东方财富 | 龙虎榜 | 腾讯 (内外盘差) | - | ⚠️ 部分实现 |
| **北向资金** | 东方财富 | - | - | - | ✅ 正常 |
| **融资融券** | 东方财富 | - | - | - | ✅ 正常 |
| **龙虎榜** | 东方财富 | - | - | - | ✅ 正常 |

## 新闻/情绪数据

| 数据类型 | 主数据源 | 降级 1 | 降级 2 | 降级 3 | 状态 |
|---------|---------|-------|-------|-------|------|
| **个股新闻** | 东方财富 | 财联社 | 金十数据 | 新浪 | ✅ 完整 |
| **市场情绪** | 东方财富 | 同花顺涨跌家数 | - | - | ✅ 正常 |
| **新闻情绪分析** | 5 源聚合 | - | - | - | ✅ 正常 |

## 特色数据

| 数据类型 | 主数据源 | 降级 1 | 降级 2 | 状态 |
|---------|---------|-------|-------|------|
| **涨跌停池** | 同花顺 | - | - | ✅ 正常 |
| **市场扫描** | 同花顺 | 新浪 | - | ✅ 完整 |
| **成交额排行** | 同花顺 | 新浪 | - | ✅ 完整 |

---

## 资金流降级链路详细说明

### 分钟级资金流

**降级顺序**: 同花顺 → 东方财富 → 腾讯

**同花顺** (`ths_market.py`):
- URL: `https://d.10jqka.com.cn/v4/time/hs_{code}/capital.js`
- 数据：121 个数据点/天，包含价格、成交额、成交量
- 优点：数据详细，分钟级精度高
- 缺点：JS 解析复杂，偶尔不稳定

**东方财富** (`eastmoney_market.py`):
- URL: `https://push2.eastmoney.com/api/qt/stock/fflow/kline/get`
- 数据：可自定义 K 线数量，包含主力/超大单/大单/中单/小单
- 优点：数据稳定，包含主力资金分类
- 缺点：需要解析 klines 数组

**腾讯** (`tencent.py`):
- 数据：内外盘成交量差
- 优点：简单快速
- 缺点：简化版，只有内外盘差，无详细分类

### 主力资金净流入

**降级顺序**: 东方财富 → 龙虎榜 → 腾讯

**东方财富** (`eastmoney_market.py`):
- URL: `https://push2.eastmoney.com/api/qt/stock/fflow/kline/get`
- 参数：`klt=101` (日 K 线)
- 数据：主力净流入、超大单、大单、中单、小单
- 信号：主力流入/流出/中性

**龙虎榜** (替代信号):
- 如果主力接口失败，检查是否上榜龙虎榜
- 龙虎榜净买入 > 0 → 主力流入信号
- 龙虎榜净卖出 > 0 → 主力流出信号

**腾讯** (简化版):
- 内外盘差 = 外盘成交量 - 内盘成交量
- 外盘 > 内盘 → 主力买入信号
- 内盘 > 外盘 → 主力卖出信号

---

## 监控脚本资金异动标准

### 按市值分级

| 异动类型 | 大盘股/ETF | 中盘股 | 小盘股 |
|---------|-----------|--------|--------|
| 涨跌幅 | >1.2% | >2.0% | >3.5% |
| 量比 | >1.5 | >1.8 | >2.0 |
| 成交额 | >50 亿 | >20 亿 | >5 亿 |
| 振幅 | >2% | >3% | >5% |

### 资金流分析输出

```
**异动标的详情**
- 名称 + 异动类型 + 涨跌%+ 量比 + 最高/最低 + 评分 + 信号
- 资金流分析:
  - 成交额：XX 亿
  - 主力资金：净流入/流出 XX 万 (超大单/大单/中单/小单分布)
  - 最后 10 分钟：流入/流出/平稳
  - 数据来源：同花顺/东方财富/腾讯
- 新闻关联 (标注日期)
```

---

## 待改进项

1. **东方财富主力接口稳定性**：偶尔服务器断开，需要增加重试机制
2. **腾讯降级链路**：目前只实现行情降级，资金流降级待完善
3. **龙虎榜替代信号**：待实现龙虎榜作为主力资金替代信号
4. **缓存机制**：资金流数据可增加 5 分钟缓存，减少 API 调用

---

*最后更新：2026-02-27 | 交易蜘蛛数据源文档*
